# คู่มือการตั้งค่า Google OAuth Authentication\n\n## ขั้นตอนการตั้งค่า Google OAuth\n\n### 1. สร้าง Google Cloud Project\n\n1. ไปที่ [Google Cloud Console](https://console.cloud.google.com/)\n2. สร้างโปรเจกต์ใหม่หรือเลือกโปรเจกต์ที่มีอยู่\n3. เปิดใช้งาน Google+ API\n\n### 2. สร้าง OAuth 2.0 Client ID\n\n1. ไปที่ \"APIs & Services\" > \"Credentials\"\n2. คลิก \"+ CREATE CREDENTIALS\" > \"OAuth client ID\"\n3. เลือก \"Web application\"\n4. ตั้งชื่อ Application (เช่น \"My Next.js App\")\n5. เพิ่ม Authorized JavaScript origins:\n   - `http://localhost:3000`\n   - `http://localhost:3001`\n   - URL ของ production (ถ้ามี)\n6. เพิ่ม Authorized redirect URIs:\n   - `http://localhost:3000/api/auth/callback/google`\n   - `http://localhost:3001/api/auth/callback/google`\n   - `https://your-domain.com/api/auth/callback/google` (สำหรับ production)\n\n### 3. คัดลอก Client ID และ Client Secret\n\nหลังจากสร้าง OAuth client ID แล้ว จะได้รับ:\n- **Client ID**: ใช้สำหรับ `GOOGLE_CLIENT_ID`\n- **Client Secret**: ใช้สำหรับ `GOOGLE_CLIENT_SECRET`\n\n### 4. อัปเดต Environment Variables\n\nแก้ไขไฟล์ `.env.local` ในโปรเจกต์:\n\n```env\nMONGODB_URI=mongodb+srv://web:numvarnSc28152456@cluster0.1nhwnyf.mongodb.net/todolist?retryWrites=true&w=majority&appName=Cluster0\n\n# NextAuth Configuration\nNEXTAUTH_SECRET=your_nextauth_secret_key\nNEXTAUTH_URL=http://localhost:3000\n\n# Google OAuth Configuration\nGOOGLE_CLIENT_ID=your_actual_google_client_id_here\nGOOGLE_CLIENT_SECRET=your_actual_google_client_secret_here\n```\n\n**หมายเหตุ:** แทนที่ `your_actual_google_client_id_here` และ `your_actual_google_client_secret_here` ด้วยค่าจริงที่ได้จาก Google Cloud Console\n\n### 5. สร้าง NextAuth Secret\n\nสร้าง secret key สำหรับ NextAuth:\n\n```bash\nopenssl rand -base64 32\n```\n\nแล้วนำค่าที่ได้มาแทนที่ `your_nextauth_secret_key` ในไฟล์ `.env.local`\n\n## การทดสอบระบบ\n\n### 1. รันเซิร์ฟเวอร์\n\n```bash\nnpm run dev\n```\n\n### 2. ทดสอบ Google OAuth\n\n1. เปิด `http://localhost:3001/auth/test` (หรือ port ที่ใช้งาน)\n2. ตรวจสอบว่า Google Client ID ถูกกำหนดค่าหรือไม่\n3. ไปที่หน้า Login: `http://localhost:3001/login`\n4. คลิกปุ่ม \"เข้าสู่ระบบด้วย Google\"\n5. ทำการเข้าสู่ระบบด้วย Google Account\n6. ตรวจสอบว่าถูก redirect กลับมาที่หน้าแรกหรือไม่\n7. ตรวจสอบข้อมูล session ในหน้า auth/test\n\n### 3. ตรวจสอบฐานข้อมูล\n\nตรวจสอบว่าข้อมูลผู้ใช้ถูกบันทึกในฐานข้อมูล MongoDB:\n- `email`: อีเมลจาก Google\n- `name`: ชื่อจาก Google\n- `provider`: \"google\"\n- `providerId`: Google Account ID\n- `role`: \"user\" (default)\n\n## การแก้ไขปัญหา\n\n### ปัญหาที่อาจพบ\n\n1. **\"Error: Configuration Error\"**\n   - ตรวจสอบว่า `GOOGLE_CLIENT_ID` และ `GOOGLE_CLIENT_SECRET` ถูกตั้งค่าแล้ว\n   - ตรวจสอบว่า OAuth client ID ใน Google Cloud Console ถูกตั้งค่า redirect URIs ถูกต้อง\n\n2. **\"Error: OAuthSignin\"**\n   - ตรวจสอบ redirect URI ใน Google Cloud Console\n   - ตรวจสอบว่า Google+ API เปิดใช้งานแล้ว\n\n3. **\"Error: OAuthCallback\"**\n   - ตรวจสอบ NEXTAUTH_URL ใน .env.local\n   - ตรวจสอบ NEXTAUTH_SECRET\n\n4. **ไม่สามารถบันทึกข้อมูลในฐานข้อมูล**\n   - ตรวจสอบการเชื่อมต่อ MongoDB\n   - ตรวจสอบ User model schema\n\n### การตรวจสอบ Logs\n\nเปิด Developer Tools ใน Browser และดู Console logs หรือตรวจสอบ terminal logs เพื่อดูข้อความ error detail\n\n## คุณสมบัติที่ใช้งานได้\n\n✅ **เข้าสู่ระบบด้วย Google**  \n✅ **สร้าง account อัตโนมัติสำหรับผู้ใช้ใหม่**  \n✅ **เชื่อมโยงกับ account ที่มีอยู่แล้ว**  \n✅ **จัดการ session และ JWT tokens**  \n✅ **Role-based access control**  \n✅ **Logout functionality**  \n✅ **Error handling และ user feedback**  \n✅ **Responsive UI design**  \n\n## Next Steps\n\n1. **Production Deployment**: อัปเดต `NEXTAUTH_URL` สำหรับ production\n2. **Security**: เพิ่มการตรวจสอบเพิ่มเติมสำหรับ user roles\n3. **UI/UX**: ปรับปรุง UI ตามต้องการ\n4. **Analytics**: เพิ่มการติดตามการใช้งาน Google OAuth\n5. **Email Verification**: เพิ่มการยืนยันอีเมลสำหรับผู้ใช้ใหม่\n\n## การติดต่อ\n\nหากมีปัญหาหรือข้อสงสัย กรุณาตรวจสอบ:\n1. [NextAuth.js Documentation](https://next-auth.js.org/)\n2. [Google OAuth 2.0 Documentation](https://developers.google.com/identity/protocols/oauth2)\n3. [Next.js Documentation](https://nextjs.org/docs)\n